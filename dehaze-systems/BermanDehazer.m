classdef (Sealed) BermanDehazer < BaseDehazer
%% You would not believe the effort it took to rewrite this with no for-loops.
    properties (Constant)
        FrameDelay  = 0;
        PredictsA   = true;
        PredictsT   = true;
		
		KD_n = 1000;
		KD_points = [-0.942500000000000,-0.204100000000000,-0.264800000000000;0.522400000000000,0.753900000000000,0.398500000000000;0.552800000000000,0.0429000000000000,-0.832200000000000;0.649900000000000,0.0243000000000000,-0.759600000000000;0.698600000000000,0.119900000000000,-0.705400000000000;-0.0303000000000000,0.992900000000000,-0.115100000000000;0.848200000000000,0.0839000000000000,-0.523000000000000;0.952600000000000,0.0586000000000000,-0.298500000000000;-0.225300000000000,-0.154400000000000,-0.962000000000000;0.906500000000000,0.0667000000000000,-0.416800000000000;0.931300000000000,-0.0364000000000000,-0.362500000000000;0.927400000000000,0.252800000000000,-0.275500000000000;0.960100000000000,0.157500000000000,-0.231100000000000;0.982700000000000,0.0588000000000000,-0.175900000000000;0.455200000000000,0.214500000000000,0.864100000000000;0.0245000000000000,0.635400000000000,0.771800000000000;0.983800000000000,0.179400000000000,0.000300000000000000;0.994400000000000,0.0840000000000000,0.0637000000000000;0.152200000000000,0.204400000000000,-0.967000000000000;0.978400000000000,0.104800000000000,0.178400000000000;0.184600000000000,0.874200000000000,-0.449000000000000;0.935300000000000,0.0254000000000000,0.352800000000000;0.886300000000000,0.0396000000000000,0.461300000000000;-0.468300000000000,0.231500000000000,0.852700000000000;0.851400000000000,-0.0566000000000000,0.521500000000000;0.824100000000000,0.0513000000000000,0.564200000000000;0.780300000000000,-0.0439000000000000,0.623800000000000;0.0253000000000000,-0.0740000000000000,0.996900000000000;0.657100000000000,0.0871000000000000,0.748700000000000;0.567600000000000,0.130400000000000,0.812900000000000;0.401100000000000,0.0242000000000000,0.915700000000000;-0.144200000000000,0.965600000000000,0.216500000000000;0.373000000000000,-0.927100000000000,-0.0358000000000000;0.378100000000000,0.204300000000000,-0.903000000000000;0.506700000000000,0.150700000000000,-0.848900000000000;0.608400000000000,0.135200000000000,-0.782000000000000;0.652300000000000,0.232200000000000,-0.721500000000000;0.778600000000000,0.102600000000000,-0.619000000000000;0.778200000000000,0.486400000000000,-0.397400000000000;0.808300000000000,0.198300000000000,-0.554400000000000;0.825100000000000,0.292900000000000,-0.483100000000000;0.922700000000000,0.160500000000000,-0.350600000000000;-0.193000000000000,-0.265200000000000,-0.944700000000000;0.299100000000000,-0.706800000000000,-0.641000000000000;0.942000000000000,0.288700000000000,-0.171400000000000;0.959700000000000,0.273100000000000,-0.0659000000000000;0.924500000000000,0.377500000000000,-0.0524000000000000;0.912400000000000,0.403400000000000,0.0693000000000000;0.887100000000000,0.422800000000000,0.185100000000000;0.953900000000000,0.297000000000000,0.0444000000000000;0.948500000000000,0.220800000000000,0.227000000000000;0.935800000000000,0.316300000000000,0.155600000000000;0.905200000000000,0.331800000000000,0.265600000000000;0.911000000000000,0.236300000000000,0.337900000000000;0.859600000000000,0.249800000000000,0.445700000000000;0.851100000000000,0.150700000000000,0.502800000000000;0.526800000000000,-0.161700000000000,-0.834500000000000;0.406200000000000,-0.869000000000000,-0.282500000000000;0.784900000000000,0.160900000000000,0.598400000000000;0.629700000000000,0.208900000000000,0.748200000000000;-0.499200000000000,-0.545700000000000,0.673100000000000;0.478400000000000,0.106900000000000,0.871600000000000;0.372100000000000,0.141800000000000,0.917300000000000;0.294000000000000,0.0590000000000000,0.954000000000000;0.177600000000000,0.00980000000000000,-0.984100000000000;0.459900000000000,0.250700000000000,-0.851800000000000;0.560600000000000,0.245000000000000,-0.791000000000000;0.861600000000000,0.343900000000000,0.373300000000000;0.591000000000000,0.342600000000000,-0.730300000000000;0.679200000000000,0.329200000000000,-0.655900000000000;0.698000000000000,0.421900000000000,-0.578600000000000;0.757300000000000,0.313000000000000,-0.573200000000000;0.709200000000000,0.508200000000000,-0.488700000000000;0.834700000000000,0.380900000000000,-0.397700000000000;0.839000000000000,0.454800000000000,-0.298800000000000;0.775500000000000,0.557200000000000,-0.297000000000000;0.835700000000000,0.510300000000000,-0.202800000000000;0.879700000000000,0.462900000000000,-0.108700000000000;0.710500000000000,0.585800000000000,-0.389900000000000;0.821300000000000,0.562800000000000,-0.0929000000000000;0.873100000000000,0.487500000000000,0.000100000000000000;0.853600000000000,0.509300000000000,0.109300000000000;0.823200000000000,0.524100000000000,0.218300000000000;0.781400000000000,0.531900000000000,0.326300000000000;0.849500000000000,0.435700000000000,0.297500000000000;-0.246800000000000,0.102700000000000,0.963600000000000;0.797700000000000,0.444900000000000,0.407100000000000;0.162700000000000,-0.231000000000000,0.959300000000000;0.738900000000000,0.362300000000000,0.568100000000000;0.794800000000000,0.259900000000000,0.548400000000000;0.663200000000000,0.372200000000000,0.649400000000000;0.575700000000000,0.434000000000000,0.692900000000000;0.513200000000000,0.374000000000000,0.772500000000000;0.537600000000000,0.255500000000000,0.803600000000000;0.349200000000000,0.258700000000000,0.900600000000000;0.215800000000000,-0.0260000000000000,0.976100000000000;0.231000000000000,0.112600000000000,-0.966400000000000;0.288900000000000,0.320000000000000,-0.902300000000000;0.387200000000000,0.336000000000000,-0.858600000000000;0.492900000000000,0.349800000000000,-0.796600000000000;0.614300000000000,0.435300000000000,-0.658100000000000;0.462600000000000,0.616700000000000,-0.636900000000000;-0.638900000000000,0.0488000000000000,-0.767700000000000;0.630800000000000,0.522800000000000,-0.573400000000000;0.840500000000000,-0.507000000000000,0.190800000000000;0.635800000000000,0.676200000000000,-0.372100000000000;0.704900000000000,0.651100000000000,-0.281300000000000;0.204800000000000,-0.448000000000000,0.870300000000000;0.768600000000000,0.611200000000000,-0.188700000000000;0.672500000000000,0.738300000000000,-0.0519000000000000;0.752300000000000,0.654700000000000,-0.0744000000000000;0.808700000000000,0.587900000000000,0.0188000000000000;0.732900000000000,0.679200000000000,0.0388000000000000;0.787300000000000,-0.601500000000000,0.135300000000000;0.569000000000000,0.771500000000000,0.284700000000000;-0.149100000000000,-0.240300000000000,0.959200000000000;0.750100000000000,0.617700000000000,0.236100000000000;-0.785000000000000,0.595700000000000,0.170200000000000;0.616200000000000,0.696900000000000,0.367000000000000;0.725500000000000,0.534300000000000,0.433900000000000;0.652000000000000,0.613600000000000,0.445400000000000;0.724800000000000,0.460700000000000,0.512300000000000;0.649800000000000,0.471700000000000,0.596000000000000;0.480600000000000,0.488000000000000,0.728600000000000;-0.617300000000000,0.775300000000000,0.133400000000000;0.433800000000000,0.325300000000000,0.840300000000000;0.240500000000000,0.298300000000000,0.923700000000000;0.266100000000000,0.181100000000000,0.946800000000000;0.270300000000000,0.216200000000000,-0.938200000000000;0.446600000000000,0.888100000000000,0.108700000000000;0.309900000000000,0.429000000000000,-0.848500000000000;0.335400000000000,0.526500000000000,-0.781200000000000;0.441700000000000,0.532100000000000,-0.722300000000000;-0.766900000000000,-0.100000000000000,-0.633900000000000;0.555400000000000,0.614100000000000,-0.560700000000000;-0.787600000000000,0.499600000000000,-0.360800000000000;0.559400000000000,0.690600000000000,-0.458500000000000;0.626000000000000,0.735600000000000,-0.258800000000000;0.703100000000000,0.695200000000000,0.149600000000000;0.462100000000000,-0.199700000000000,0.864000000000000;0.538100000000000,0.810300000000000,-0.232200000000000;0.608400000000000,0.780600000000000,-0.143000000000000;0.582000000000000,0.812700000000000,-0.0279000000000000;0.646300000000000,0.760600000000000,0.0617000000000000;0.550100000000000,0.830700000000000,0.0855000000000000;0.562400000000000,-0.213200000000000,0.798900000000000;0.664000000000000,0.701700000000000,0.258500000000000;0.722400000000000,-0.686800000000000,0.0807000000000000;-0.0298000000000000,0.376200000000000,-0.926100000000000;0.564500000000000,0.671100000000000,0.480600000000000;0.468700000000000,0.722800000000000,0.507700000000000;0.625600000000000,0.563600000000000,0.539400000000000;0.554800000000000,0.535100000000000,0.637100000000000;-0.464800000000000,0.833000000000000,0.300200000000000;0.452200000000000,0.587600000000000,0.670900000000000;0.375400000000000,0.537600000000000,0.755000000000000;0.407700000000000,0.433400000000000,0.803700000000000;0.0966000000000000,0.442900000000000,0.891400000000000;-0.0566000000000000,-0.955800000000000,0.288500000000000;0.107700000000000,0.0948000000000000,-0.989700000000000;0.201700000000000,0.414800000000000,-0.887300000000000;0.519700000000000,0.443600000000000,-0.730200000000000;0.248900000000000,0.606400000000000,-0.755200000000000;0.271100000000000,0.688300000000000,-0.672900000000000;0.359200000000000,0.614400000000000,-0.702500000000000;0.379100000000000,0.693500000000000,-0.612600000000000;0.290300000000000,0.760700000000000,-0.580500000000000;0.388300000000000,0.766900000000000,-0.510900000000000;0.381800000000000,0.832900000000000,-0.400700000000000;0.359800000000000,0.886200000000000,-0.291800000000000;0.462800000000000,0.827100000000000,-0.318800000000000;-0.183500000000000,0.306000000000000,0.934200000000000;0.439100000000000,0.874400000000000,-0.206500000000000;0.513400000000000,0.850000000000000,-0.118000000000000;0.482000000000000,0.876200000000000,-0.00440000000000000;0.484000000000000,-0.307800000000000,0.819100000000000;0.128000000000000,0.334800000000000,0.933500000000000;0.512000000000000,0.835800000000000,0.198200000000000;0.469900000000000,0.825800000000000,0.311800000000000;0.365400000000000,0.869200000000000,0.333200000000000;0.423000000000000,0.801400000000000,0.423000000000000;0.522000000000000,0.627900000000000,0.577300000000000;0.366200000000000,0.765300000000000,0.529400000000000;0.258000000000000,0.798000000000000,0.544700000000000;0.343400000000000,0.632500000000000,0.694300000000000;0.401700000000000,-0.769900000000000,0.495900000000000;0.264000000000000,0.575800000000000,0.773800000000000;0.296900000000000,0.476500000000000,0.827500000000000;0.213000000000000,0.408700000000000,0.887500000000000;0.157100000000000,0.219200000000000,0.963000000000000;0.0338000000000000,0.187200000000000,-0.981700000000000;0.177800000000000,0.311000000000000,-0.933600000000000;0.604100000000000,-0.733300000000000,-0.311900000000000;0.135200000000000,0.594200000000000,-0.792900000000000;-0.539500000000000,-0.410900000000000,-0.734900000000000;0.156800000000000,0.679100000000000,-0.717100000000000;0.108700000000000,-0.641500000000000,-0.759400000000000;0.176800000000000,0.753400000000000,-0.633300000000000;0.0925000000000000,-0.549600000000000,-0.830300000000000;0.294700000000000,0.828200000000000,-0.476700000000000;-0.782500000000000,0.147500000000000,-0.604900000000000;0.274900000000000,0.886500000000000,-0.372200000000000;0.721100000000000,-0.303400000000000,-0.622800000000000;0.330300000000000,0.926100000000000,-0.182500000000000;0.337600000000000,0.932300000000000,0.129800000000000;0.260600000000000,0.964700000000000,0.0375000000000000;0.407800000000000,0.885700000000000,0.221800000000000;0.298200000000000,0.923700000000000,0.240600000000000;-0.239600000000000,0.410700000000000,-0.879700000000000;0.871100000000000,0.178300000000000,-0.457500000000000;0.256200000000000,0.901300000000000,0.349200000000000;0.210800000000000,0.865400000000000,0.454600000000000;0.318900000000000,0.838600000000000,0.441700000000000;0.145000000000000,0.819800000000000,0.554000000000000;0.700000000000000,-0.531500000000000,0.477000000000000;0.304900000000000,0.719100000000000,0.624400000000000;0.229500000000000,0.666400000000000,0.709400000000000;0.189800000000000,0.747800000000000,0.636200000000000;0.147200000000000,0.606600000000000,0.781300000000000;0.0623000000000000,0.543600000000000,0.837000000000000;0.0763000000000000,0.134900000000000,0.987900000000000;0.0624000000000000,0.295400000000000,-0.953300000000000;0.0871000000000000,0.400100000000000,-0.912300000000000;0.369100000000000,-0.804700000000000,-0.465000000000000;-0.0480000000000000,0.729300000000000,-0.682500000000000;-0.639600000000000,0.729900000000000,0.241100000000000;0.0646000000000000,0.752200000000000,-0.655700000000000;0.843800000000000,-0.413600000000000,-0.342000000000000;0.0872000000000000,0.823300000000000,-0.560900000000000;0.0781000000000000,0.894600000000000,-0.440000000000000;0.158800000000000,0.924300000000000,-0.347100000000000;0.0424000000000000,0.942100000000000,-0.332800000000000;0.126200000000000,0.961800000000000,-0.243000000000000;0.246600000000000,0.931800000000000,-0.266500000000000;0.213300000000000,0.963900000000000,-0.159700000000000;0.0913000000000000,0.986500000000000,-0.136100000000000;0.296500000000000,0.952300000000000,-0.0727000000000000;-0.0677000000000000,0.997700000000000,-0.00470000000000000;0.178000000000000,0.982700000000000,-0.0517000000000000;0.748800000000000,0.0605000000000000,0.660100000000000;0.223100000000000,0.963600000000000,0.147100000000000;0.103300000000000,0.981100000000000,0.163600000000000;0.142700000000000,0.921800000000000,0.360400000000000;0.0997000000000000,0.881000000000000,0.462500000000000;0.0641000000000000,0.961200000000000,0.268200000000000;0.0694000000000000,0.766800000000000,0.638200000000000;-0.0169000000000000,0.716600000000000,0.697200000000000;0.110300000000000,0.691900000000000,0.713500000000000;-0.0998000000000000,0.655700000000000,0.748400000000000;-0.0584000000000000,0.569100000000000,0.820200000000000;-0.0211000000000000,0.471800000000000,0.881500000000000;0.0124000000000000,0.365900000000000,0.930600000000000;0.0450000000000000,0.254100000000000,0.966100000000000;-0.0551000000000000,0.267500000000000,-0.962000000000000;-0.00400000000000000,0.479500000000000,-0.877500000000000;-0.0673000000000000,0.641700000000000,-0.764000000000000;-0.682100000000000,0.729700000000000,0.0471000000000000;-0.151800000000000,0.700000000000000,-0.697900000000000;-0.0348000000000000,0.800100000000000,-0.598900000000000;0.640100000000000,-0.291000000000000,-0.711000000000000;-0.148800000000000,0.791300000000000,-0.593000000000000;-0.115100000000000,0.855800000000000,-0.504300000000000;-0.0421000000000000,0.910400000000000,-0.411500000000000;-0.156700000000000,0.904000000000000,-0.397800000000000;-0.194800000000000,0.936900000000000,-0.290400000000000;-0.114500000000000,0.972900000000000,-0.200800000000000;-0.151500000000000,0.984300000000000,-0.0910000000000000;-0.469200000000000,0.0630000000000000,-0.880800000000000;0.474700000000000,0.695300000000000,-0.539600000000000;-0.188500000000000,0.981900000000000,0.0205000000000000;-0.105700000000000,0.988700000000000,0.106000000000000;0.0169000000000000,0.996500000000000,0.0814000000000000;-0.183700000000000,0.926600000000000,0.328200000000000;-0.0634000000000000,0.952700000000000,0.297100000000000;-0.103900000000000,0.909600000000000,0.402300000000000;-0.0142000000000000,0.885200000000000,0.465100000000000;0.0264000000000000,0.830900000000000,0.555700000000000;-0.103100000000000,0.847500000000000,0.520700000000000;0.206800000000000,-0.677900000000000,-0.705400000000000;-0.0618000000000000,0.786800000000000,0.614100000000000;-0.180100000000000,0.584800000000000,0.790900000000000;-0.139300000000000,0.494000000000000,0.858300000000000;-0.843800000000000,-0.463000000000000,0.271400000000000;-0.0364000000000000,0.168800000000000,0.985000000000000;-0.168300000000000,0.237400000000000,-0.956700000000000;-0.121600000000000,0.450100000000000,-0.884700000000000;-0.0947000000000000,0.548700000000000,-0.830600000000000;-0.182900000000000,0.608800000000000,-0.772000000000000;-0.270100000000000,0.653600000000000,-0.707000000000000;-0.234000000000000,0.737200000000000,-0.633800000000000;-0.285000000000000,0.785500000000000,-0.549300000000000;-0.222500000000000,0.846900000000000,-0.483000000000000;-0.339500000000000,0.824900000000000,-0.452100000000000;-0.270700000000000,0.886200000000000,-0.376000000000000;-0.308700000000000,0.912800000000000,-0.267500000000000;-0.231800000000000,0.955900000000000,-0.180100000000000;-0.345100000000000,0.925700000000000,-0.154800000000000;0.713600000000000,0.269600000000000,0.646600000000000;-0.268700000000000,0.960900000000000,-0.0675000000000000;-0.304700000000000,0.951300000000000,0.0460000000000000;-0.414800000000000,0.906700000000000,0.0758000000000000;-0.225100000000000,0.965300000000000,0.132600000000000;-0.258600000000000,0.933800000000000,0.247300000000000;-0.358100000000000,0.891200000000000,0.278500000000000;-0.163600000000000,-0.122600000000000,0.978900000000000;-0.199100000000000,0.867800000000000,0.455400000000000;-0.277800000000000,0.883100000000000,0.378100000000000;0.474600000000000,0.766900000000000,-0.432000000000000;-0.283200000000000,0.814800000000000,0.505800000000000;-0.143700000000000,0.731400000000000,0.666700000000000;0.948900000000000,0.123200000000000,0.290600000000000;-0.223300000000000,0.664200000000000,0.713400000000000;0.907900000000000,-0.0710000000000000,0.413100000000000;-0.103000000000000,0.392000000000000,0.914200000000000;-0.262600000000000,0.214800000000000,0.940700000000000;-0.0787000000000000,0.150100000000000,-0.985500000000000;-0.146800000000000,0.346400000000000,-0.926500000000000;-0.212600000000000,0.512600000000000,-0.831900000000000;-0.301700000000000,0.562600000000000,-0.769700000000000;0.784400000000000,0.606900000000000,0.128400000000000;-0.999500000000000,0.0320000000000000,0.00870000000000000;-0.345900000000000,0.702300000000000,-0.622200000000000;-0.451800000000000,0.659400000000000,-0.600900000000000;-0.399500000000000,0.748900000000000,-0.528700000000000;-0.604400000000000,0.642300000000000,-0.471300000000000;-0.385100000000000,0.854800000000000,-0.348000000000000;-0.493500000000000,0.808100000000000,-0.321600000000000;-0.520900000000000,0.826800000000000,-0.212400000000000;-0.418600000000000,0.875900000000000,-0.239900000000000;-0.453400000000000,0.882400000000000,-0.125800000000000;-0.381300000000000,0.923600000000000,-0.0401000000000000;0.882400000000000,0.271200000000000,-0.384500000000000;-0.487600000000000,0.873000000000000,-0.00910000000000000;-0.517100000000000,0.849000000000000,0.108400000000000;-0.337200000000000,0.927600000000000,0.160700000000000;-0.00300000000000000,0.860800000000000,-0.508900000000000;-0.480400000000000,0.778100000000000,0.404800000000000;-0.384800000000000,0.790100000000000,0.477100000000000;-0.362500000000000,0.734800000000000,0.573300000000000;-0.991100000000000,-0.0428000000000000,0.126400000000000;-0.260900000000000,0.737500000000000,0.622900000000000;-0.875800000000000,0.0725000000000000,0.477200000000000;-0.340000000000000,0.662700000000000,0.667300000000000;-0.259000000000000,0.506700000000000,0.822300000000000;-0.218800000000000,0.412300000000000,0.884400000000000;-0.427200000000000,0.0449000000000000,0.903000000000000;-0.188400000000000,0.124600000000000,-0.974200000000000;-0.262800000000000,0.303300000000000,-0.915900000000000;-0.329900000000000,0.464300000000000,-0.822000000000000;-0.414000000000000,0.515700000000000,-0.750100000000000;-0.518800000000000,0.461500000000000,-0.719600000000000;-0.488800000000000,0.563700000000000,-0.665800000000000;-0.552000000000000,0.606800000000000,-0.571900000000000;-0.505500000000000,0.700600000000000,-0.503600000000000;-0.550900000000000,0.732300000000000,-0.400200000000000;-0.595700000000000,0.748600000000000,-0.291000000000000;-0.645300000000000,0.670700000000000,-0.365700000000000;-0.828900000000000,-0.00990000000000000,0.559400000000000;-0.692700000000000,0.675000000000000,-0.254300000000000;-0.614300000000000,0.767700000000000,-0.182700000000000;-0.791000000000000,0.559100000000000,-0.248400000000000;-0.554200000000000,0.826900000000000,-0.0952000000000000;-0.585900000000000,0.810000000000000,0.0240000000000000;-0.453300000000000,-0.0577000000000000,-0.889500000000000;0.637600000000000,0.604100000000000,-0.478100000000000;-0.707800000000000,0.689300000000000,0.154500000000000;-0.544700000000000,0.809900000000000,0.217600000000000;-0.563500000000000,0.759700000000000,0.324400000000000;-0.648700000000000,0.676200000000000,0.349200000000000;-0.472600000000000,0.718600000000000,0.510200000000000;-0.554000000000000,0.638700000000000,0.534000000000000;-0.382900000000000,0.612500000000000,-0.691600000000000;-0.497500000000000,0.497900000000000,0.710400000000000;-0.420900000000000,0.583900000000000,0.694200000000000;-0.381600000000000,0.507300000000000,0.772700000000000;-0.336400000000000,0.424100000000000,0.840800000000000;-0.295900000000000,0.325800000000000,0.897900000000000;0.106000000000000,0.0120000000000000,0.994300000000000;-0.281800000000000,0.190500000000000,-0.940400000000000;0.719800000000000,-0.500100000000000,-0.481400000000000;-0.354400000000000,0.359200000000000,-0.863400000000000;-0.461200000000000,0.302000000000000,-0.834300000000000;-0.187200000000000,0.799000000000000,0.571400000000000;0.00660000000000000,0.974400000000000,-0.224600000000000;-0.588100000000000,0.505800000000000,-0.631100000000000;-0.645800000000000,0.545400000000000,-0.534400000000000;-0.733200000000000,0.480800000000000,-0.480900000000000;-0.696700000000000,0.573900000000000,-0.430500000000000;-0.680600000000000,0.442100000000000,-0.584300000000000;-0.770100000000000,0.618400000000000,-0.156500000000000;-0.731000000000000,0.598300000000000,-0.328100000000000;-0.697200000000000,0.701500000000000,-0.148000000000000;-0.810100000000000,0.584700000000000,-0.0434000000000000;-0.737200000000000,0.674300000000000,-0.0438000000000000;-0.334400000000000,-0.101700000000000,-0.936900000000000;-0.766600000000000,0.639100000000000,0.0624000000000000;-0.741200000000000,-0.563900000000000,-0.364300000000000;-0.721700000000000,0.640500000000000,0.262500000000000;-0.723800000000000,0.583400000000000,0.368400000000000;-0.924200000000000,0.381000000000000,-0.0272000000000000;-0.645000000000000,0.614800000000000,0.453800000000000;-0.628100000000000,0.548600000000000,0.551900000000000;0.205600000000000,-0.0969000000000000,-0.973800000000000;0.693100000000000,0.701000000000000,-0.167800000000000;-0.564700000000000,0.400300000000000,0.721700000000000;-0.456300000000000,0.419700000000000,0.784600000000000;-0.448900000000000,0.784400000000000,-0.428000000000000;-0.409300000000000,0.335400000000000,0.848500000000000;-0.153400000000000,0.192500000000000,0.969200000000000;0.977400000000000,0.172600000000000,-0.121700000000000;-0.373800000000000,0.247700000000000,-0.893800000000000;-0.555800000000000,0.238100000000000,-0.796500000000000;-0.448500000000000,0.657100000000000,0.605900000000000;-0.542200000000000,0.353500000000000,-0.762300000000000;-0.616000000000000,0.400400000000000,-0.678400000000000;-0.714700000000000,0.220300000000000,-0.663800000000000;-0.761000000000000,0.369900000000000,-0.532900000000000;-0.803900000000000,0.407800000000000,-0.432900000000000;-0.897000000000000,0.289100000000000,-0.334300000000000;-0.904500000000000,0.356400000000000,-0.234400000000000;-0.854900000000000,0.392400000000000,-0.339500000000000;-0.236700000000000,-0.538400000000000,-0.808800000000000;-0.895600000000000,0.423100000000000,-0.137600000000000;0.408800000000000,0.907700000000000,-0.0944000000000000;-0.873400000000000,0.485900000000000,-0.0326000000000000;-0.893700000000000,0.442000000000000,0.0773000000000000;-0.835900000000000,0.544600000000000,0.0684000000000000;-0.901000000000000,0.391900000000000,0.186200000000000;-0.849100000000000,0.497100000000000,0.178500000000000;-0.840400000000000,0.377000000000000,0.389400000000000;-0.792400000000000,0.543300000000000,0.277300000000000;-0.850900000000000,0.440600000000000,0.286100000000000;-0.788000000000000,0.483200000000000,0.381600000000000;-0.772200000000000,0.415000000000000,0.481100000000000;-0.745100000000000,0.340500000000000,0.573600000000000;-0.692300000000000,0.448400000000000,0.565300000000000;-0.619100000000000,0.291400000000000,0.729200000000000;0.710300000000000,0.167400000000000,0.683800000000000;0.211700000000000,-0.845400000000000,0.490500000000000;0.339900000000000,-0.883000000000000,0.323700000000000;-0.00550000000000000,0.0495000000000000,0.998800000000000;-0.134800000000000,0.0302000000000000,-0.990400000000000;-0.280800000000000,0.0672000000000000,-0.957400000000000;-0.471100000000000,0.184300000000000,-0.862600000000000;-0.632800000000000,0.288200000000000,-0.718700000000000;-0.641300000000000,0.171000000000000,-0.748000000000000;-0.702200000000000,0.332200000000000,-0.629700000000000;-0.781500000000000,0.263100000000000,-0.565700000000000;0.141200000000000,0.988400000000000,0.0565000000000000;-0.837600000000000,0.302500000000000,-0.454800000000000;-0.888000000000000,0.208600000000000,-0.409800000000000;-0.268800000000000,-0.928600000000000,0.256000000000000;-0.934900000000000,0.165800000000000,-0.313700000000000;-0.941000000000000,0.313300000000000,-0.128300000000000;-0.962800000000000,0.269400000000000,-0.0203000000000000;-0.143500000000000,-0.481300000000000,-0.864700000000000;-0.939000000000000,0.333900000000000,0.0824000000000000;-0.971600000000000,0.219900000000000,0.0875000000000000;-0.905800000000000,0.0963000000000000,-0.412500000000000;-0.940300000000000,0.281900000000000,0.190500000000000;-0.897000000000000,0.331600000000000,0.292200000000000;-0.714000000000000,0.518800000000000,0.470200000000000;-0.880400000000000,0.265500000000000,0.393000000000000;-0.818400000000000,0.305200000000000,0.486800000000000;-0.852800000000000,0.190400000000000,0.486300000000000;-0.785600000000000,0.226500000000000,0.575700000000000;-0.748300000000000,-0.221900000000000,-0.625100000000000;-0.659600000000000,0.176100000000000,0.730700000000000;-0.567800000000000,0.205900000000000,0.797000000000000;-0.490200000000000,0.126400000000000,0.862400000000000;-0.369600000000000,0.233000000000000,0.899500000000000;-0.627700000000000,-0.778400000000000,0.00200000000000000;0.0688000000000000,-0.992500000000000,-0.101500000000000;-0.369200000000000,0.00590000000000000,-0.929300000000000;-0.552000000000000,-0.00310000000000000,-0.833800000000000;-0.715300000000000,0.0994000000000000,-0.691700000000000;0.0547000000000000,0.998100000000000,-0.0277000000000000;-0.780700000000000,0.0274000000000000,-0.624300000000000;-0.842200000000000,0.185900000000000,-0.506000000000000;-0.843800000000000,0.0767000000000000,-0.531200000000000;-0.970000000000000,-0.139200000000000,0.199400000000000;0.0243000000000000,0.929200000000000,0.368700000000000;0.342800000000000,0.102100000000000,-0.933800000000000;-0.969800000000000,0.121700000000000,-0.211200000000000;-0.979600000000000,0.00230000000000000,-0.200800000000000;-0.972600000000000,0.198500000000000,-0.121200000000000;-0.942600000000000,0.243800000000000,-0.228400000000000;-0.988100000000000,0.153100000000000,-0.0128000000000000;-0.990600000000000,0.0993000000000000,0.0943000000000000;-0.966800000000000,0.167100000000000,0.193200000000000;-0.952500000000000,0.0954000000000000,0.289100000000000;0.183800000000000,0.949300000000000,0.255100000000000;-0.0779000000000000,0.948200000000000,-0.307900000000000;-0.926600000000000,0.0310000000000000,0.374800000000000;-0.814100000000000,0.108700000000000,0.570500000000000;-0.741900000000000,0.143200000000000,0.655100000000000;-0.683700000000000,0.0592000000000000,0.727400000000000;-0.594400000000000,0.0936000000000000,0.798700000000000;-0.528800000000000,0.0106000000000000,0.848700000000000;0.194700000000000,0.817700000000000,-0.541800000000000;-0.120300000000000,0.0842000000000000,0.989200000000000;-0.239200000000000,-0.0348000000000000,-0.970300000000000;-0.533100000000000,-0.121400000000000,-0.837300000000000;-0.627400000000000,-0.0729000000000000,-0.775200000000000;-0.709400000000000,-0.0238000000000000,-0.704400000000000;-0.297100000000000,-0.840100000000000,0.453900000000000;-0.660300000000000,0.372900000000000,0.651900000000000;-0.831400000000000,-0.0490000000000000,-0.553500000000000;-0.886800000000000,0,-0.462200000000000;-0.878200000000000,-0.116800000000000,-0.463700000000000;0.225000000000000,0.515100000000000,-0.827100000000000;-0.928400000000000,-0.0423000000000000,-0.369100000000000;-0.959000000000000,-0.0857000000000000,-0.270200000000000;-0.984900000000000,-0.166400000000000,-0.0485000000000000;-0.994900000000000,-0.0415000000000000,-0.0921000000000000;-0.996700000000000,-0.0784000000000000,0.0190000000000000;0.972700000000000,0.202000000000000,0.114400000000000;-0.937100000000000,-0.174500000000000,0.302200000000000;-0.980500000000000,0.0459000000000000,0.191000000000000;-0.920400000000000,-0.278300000000000,0.274500000000000;-0.930600000000000,-0.0793000000000000,0.357300000000000;-0.964800000000000,-0.0392000000000000,0.260000000000000;-0.885100000000000,-0.0446000000000000,0.463300000000000;-0.836600000000000,-0.130000000000000,0.532200000000000;-0.774100000000000,-0.0963000000000000,0.625700000000000;-0.706300000000000,-0.180500000000000,0.684500000000000;-0.701700000000000,-0.0616000000000000,0.709800000000000;-0.628200000000000,-0.144800000000000,0.764500000000000;-0.619800000000000,-0.0262000000000000,0.784300000000000;-0.358500000000000,0.128600000000000,0.924700000000000;-0.328600000000000,0.00950000000000000,0.944400000000000;0.851300000000000,-0.522800000000000,-0.0450000000000000;-0.422100000000000,-0.168700000000000,-0.890700000000000;-0.503300000000000,-0.232800000000000,-0.832200000000000;-0.604300000000000,-0.191600000000000,-0.773400000000000;-0.691600000000000,-0.147900000000000,-0.707000000000000;-0.667600000000000,-0.265700000000000,-0.695500000000000;-0.818200000000000,-0.171800000000000,-0.548600000000000;-0.775600000000000,-0.631200000000000,0.00740000000000000;-0.600400000000000,0.477900000000000,0.641300000000000;-0.831900000000000,-0.350100000000000,-0.430500000000000;-0.377600000000000,0.843200000000000,0.382700000000000;-0.893200000000000,-0.281700000000000,-0.350500000000000;-0.978200000000000,-0.127100000000000,-0.163900000000000;-0.924400000000000,-0.356800000000000,-0.134800000000000;-0.960200000000000,-0.274000000000000,-0.0540000000000000;-0.961500000000000,-0.269100000000000,0.0556000000000000;-0.926600000000000,-0.375900000000000,-0.0130000000000000;-0.902700000000000,-0.372600000000000,0.215400000000000;0.201500000000000,-0.947700000000000,-0.247400000000000;0.110500000000000,-0.938600000000000,-0.326800000000000;-0.866800000000000,-0.369300000000000,0.335200000000000;-0.884400000000000,-0.263800000000000,0.385100000000000;-0.889600000000000,-0.160700000000000,0.427500000000000;-0.833600000000000,-0.243900000000000,0.495600000000000;0.537900000000000,-0.106300000000000,0.836300000000000;-0.774700000000000,-0.214200000000000,0.595000000000000;-0.701800000000000,-0.296300000000000,0.647800000000000;-0.628000000000000,-0.261800000000000,0.732900000000000;-0.442600000000000,-0.0642000000000000,0.894400000000000;0.611300000000000,0.772200000000000,0.173400000000000;-0.198200000000000,0.00160000000000000,0.980200000000000;-0.133900000000000,-0.0907000000000000,-0.986800000000000;-0.379300000000000,0.127800000000000,-0.916400000000000;-0.180400000000000,-0.880000000000000,0.439400000000000;-0.575900000000000,-0.303300000000000,-0.759200000000000;0.735200000000000,0.216700000000000,-0.642400000000000;-0.636100000000000,-0.377100000000000,-0.673200000000000;-0.795800000000000,-0.290300000000000,-0.531400000000000;-0.721000000000000,-0.337700000000000,-0.605100000000000;-0.930700000000000,0.217200000000000,0.294400000000000;-0.761200000000000,-0.404500000000000,-0.506900000000000;-0.858300000000000,-0.396900000000000,-0.325200000000000;-0.914300000000000,-0.322400000000000,-0.245200000000000;-0.813100000000000,-0.504300000000000,-0.290800000000000;-0.875100000000000,-0.433900000000000,-0.214300000000000;-0.884100000000000,-0.457900000000000,-0.0937000000000000;-0.871400000000000,-0.466800000000000,0.150700000000000;-0.302600000000000,0.588000000000000,0.750100000000000;-0.707700000000000,-0.704400000000000,-0.0539000000000000;-0.313000000000000,-0.218400000000000,-0.924300000000000;-0.826600000000000,-0.556700000000000,0.0824000000000000;-0.773600000000000,-0.544000000000000,0.325000000000000;-0.801800000000000,-0.452200000000000,0.390700000000000;-0.667200000000000,-0.507700000000000,0.545100000000000;-0.822900000000000,-0.350500000000000,0.447300000000000;-0.750300000000000,-0.432400000000000,0.500100000000000;-0.766600000000000,-0.327100000000000,0.552500000000000;-0.688200000000000,-0.405800000000000,0.601400000000000;-0.617000000000000,-0.373400000000000,0.692800000000000;-0.537000000000000,-0.337900000000000,0.773000000000000;-0.545400000000000,-0.224900000000000,0.807400000000000;-0.361400000000000,-0.131100000000000,0.923100000000000;0.186200000000000,0.0975000000000000,0.977700000000000;0.809900000000000,-0.515100000000000,-0.280500000000000;-0.280700000000000,-0.329500000000000,-0.901500000000000;-0.473400000000000,-0.342600000000000,-0.811500000000000;-0.360200000000000,-0.395400000000000,-0.844900000000000;-0.433500000000000,-0.448400000000000,-0.781600000000000;-0.585100000000000,-0.481600000000000,-0.652400000000000;-0.681000000000000,-0.447700000000000,-0.579500000000000;-0.620900000000000,-0.544800000000000,-0.563700000000000;-0.715700000000000,-0.510800000000000,-0.476200000000000;-0.791200000000000,-0.461400000000000,-0.401500000000000;-0.665500000000000,-0.645100000000000,-0.375300000000000;-0.762100000000000,-0.599500000000000,-0.244500000000000;-0.828700000000000,-0.532800000000000,-0.171400000000000;-0.775000000000000,-0.620700000000000,-0.119300000000000;-0.835000000000000,-0.548400000000000,-0.0452000000000000;-0.882800000000000,-0.468600000000000,0.0328000000000000;-0.704500000000000,-0.706700000000000,0.0651000000000000;-0.840100000000000,0.523200000000000,-0.142900000000000;-0.808200000000000,-0.552200000000000,0.204800000000000;-0.759500000000000,-0.636000000000000,0.136800000000000;-0.733200000000000,-0.630000000000000,0.256100000000000;-0.725100000000000,-0.530800000000000,0.438700000000000;-0.691800000000000,-0.620900000000000,0.368700000000000;-0.638600000000000,-0.601900000000000,0.479500000000000;0.181600000000000,0.511600000000000,0.839800000000000;-0.574200000000000,-0.575200000000000,0.582500000000000;-0.598700000000000,-0.478200000000000,0.642500000000000;-0.440900000000000,0.876700000000000,0.192600000000000;-0.449300000000000,-0.297900000000000,0.842300000000000;-0.344000000000000,-0.361000000000000,0.866800000000000;-0.455400000000000,-0.183700000000000,0.871100000000000;0.706000000000000,0.620500000000000,0.341400000000000;-0.646400000000000,0.760500000000000,-0.0609000000000000;-0.460900000000000,-0.813600000000000,0.354500000000000;-0.348300000000000,-0.517500000000000,-0.781600000000000;-0.480100000000000,-0.515400000000000,-0.709800000000000;0.385500000000000,-0.728000000000000,-0.567000000000000;-0.443300000000000,-0.668600000000000,-0.597000000000000;-0.519000000000000,-0.581700000000000,-0.626300000000000;-0.548400000000000,-0.642200000000000,-0.535500000000000;-0.570600000000000,-0.694800000000000,-0.437700000000000;-0.513100000000000,-0.811700000000000,-0.279000000000000;-0.591000000000000,-0.735000000000000,-0.332500000000000;-0.685100000000000,-0.674800000000000,-0.274500000000000;-0.610400000000000,-0.760000000000000,-0.223300000000000;-0.644300000000000,-0.706300000000000,0.293200000000000;-0.700900000000000,-0.693400000000000,-0.167300000000000;-0.539300000000000,-0.840800000000000,-0.0467000000000000;-0.622300000000000,-0.773800000000000,0.118600000000000;-0.542500000000000,-0.836700000000000,0.0749000000000000;0.742000000000000,-0.562800000000000,0.364300000000000;-0.677500000000000,-0.710800000000000,0.189100000000000;-0.556800000000000,-0.767100000000000,0.318600000000000;-0.566600000000000,0.701400000000000,0.432400000000000;-0.850300000000000,0.463000000000000,-0.250100000000000;-0.543200000000000,-0.664000000000000,0.513800000000000;-0.416300000000000,-0.509100000000000,0.753300000000000;-0.391700000000000,-0.604900000000000,0.693300000000000;-0.326800000000000,-0.466500000000000,0.821900000000000;-0.232200000000000,-0.416300000000000,0.879100000000000;-0.356200000000000,-0.249600000000000,0.900500000000000;-0.258300000000000,-0.198300000000000,0.945500000000000;-0.0369000000000000,-0.0324000000000000,-0.998800000000000;-0.169300000000000,-0.376900000000000,-0.910600000000000;-0.259900000000000,-0.442000000000000,-0.858500000000000;-0.408500000000000,-0.597200000000000,-0.690300000000000;-0.305300000000000,-0.612800000000000,-0.728900000000000;-0.365800000000000,-0.753300000000000,-0.546600000000000;-0.908700000000000,0.149300000000000,0.389800000000000;-0.470200000000000,-0.728800000000000,-0.497700000000000;-0.390300000000000,-0.806900000000000,-0.443400000000000;0.770200000000000,-0.586400000000000,0.251000000000000;-0.492800000000000,-0.777300000000000,-0.391200000000000;-0.412000000000000,-0.848100000000000,-0.333100000000000;-0.529700000000000,-0.832200000000000,-0.164100000000000;-0.440300000000000,0.412100000000000,-0.797700000000000;-0.443600000000000,-0.890600000000000,-0.100900000000000;-0.540500000000000,-0.106900000000000,0.834500000000000;-0.451800000000000,-0.891900000000000,0.0188000000000000;-0.430100000000000,-0.876000000000000,-0.218200000000000;-0.470800000000000,-0.846900000000000,0.247300000000000;-0.370600000000000,-0.905100000000000,0.208500000000000;-0.370000000000000,-0.870200000000000,0.325200000000000;-0.566300000000000,-0.797300000000000,0.208600000000000;-0.507100000000000,-0.743600000000000,0.435900000000000;0.709900000000000,-0.676400000000000,0.196100000000000;-0.438200000000000,-0.724300000000000,0.532300000000000;-0.471300000000000,-0.639000000000000,0.607900000000000;-0.362500000000000,-0.692800000000000,0.623400000000000;-0.277500000000000,-0.658100000000000,0.699900000000000;-0.304600000000000,-0.565900000000000,0.766100000000000;-0.213100000000000,-0.518300000000000,0.828200000000000;-0.247300000000000,-0.309400000000000,0.918200000000000;-0.0222000000000000,0.981500000000000,0.190000000000000;-0.0758000000000000,-0.308900000000000,-0.948100000000000;0.541600000000000,0.531400000000000,-0.651400000000000;-0.991600000000000,0.0770000000000000,-0.104000000000000;-0.114000000000000,-0.579600000000000,-0.806900000000000;-0.195200000000000,-0.629600000000000,-0.752000000000000;-0.255300000000000,-0.769800000000000,-0.585000000000000;0.112000000000000,0.500000000000000,-0.858800000000000;-0.166500000000000,-0.830900000000000,-0.531000000000000;-0.281700000000000,-0.826400000000000,-0.487500000000000;-0.216400000000000,-0.923100000000000,-0.317800000000000;-0.305600000000000,-0.872400000000000,-0.381500000000000;-0.325800000000000,-0.906400000000000,-0.268900000000000;-0.139700000000000,-0.981400000000000,-0.131400000000000;-0.341700000000000,-0.927400000000000,-0.151900000000000;0.368800000000000,-0.925600000000000,0.0851000000000000;-0.353400000000000,-0.934900000000000,-0.0320000000000000;-0.707600000000000,0.260500000000000,0.656800000000000;-0.248400000000000,-0.964900000000000,-0.0853000000000000;-0.265100000000000,-0.953100000000000,0.146200000000000;-0.364300000000000,-0.926900000000000,0.0900000000000000;-0.269200000000000,-0.892500000000000,0.362000000000000;-0.394800000000000,-0.283700000000000,-0.873800000000000;-0.950300000000000,0.0483000000000000,-0.307400000000000;-0.329000000000000,-0.771500000000000,0.544500000000000;-0.213700000000000,-0.816500000000000,0.536200000000000;-0.246100000000000,-0.741900000000000,0.623700000000000;0.906200000000000,0.138500000000000,0.399600000000000;-0.188900000000000,-0.614400000000000,0.766100000000000;-0.0981000000000000,-0.558800000000000,0.823500000000000;-0.118300000000000,-0.458400000000000,0.880800000000000;-0.135300000000000,-0.352100000000000,0.926100000000000;0.0475000000000000,-0.350800000000000,-0.935200000000000;-0.0508000000000000,-0.413200000000000,-0.909200000000000;-0.0245000000000000,-0.511500000000000,-0.858900000000000;-0.951600000000000,-0.255900000000000,0.170400000000000;-0.105100000000000,-0.687500000000000,-0.718500000000000;-0.225700000000000,-0.703800000000000,-0.673600000000000;-0.138000000000000,-0.766200000000000,-0.627600000000000;-0.0767000000000000,-0.883200000000000,-0.462700000000000;0.0175000000000000,-0.917500000000000,-0.397400000000000;-0.193300000000000,-0.883000000000000,-0.427800000000000;-0.102900000000000,-0.927600000000000,-0.359200000000000;-0.00980000000000000,-0.956700000000000,-0.290900000000000;-0.0292000000000000,-0.984000000000000,-0.175600000000000;0.877700000000000,-0.0262000000000000,-0.478500000000000;-0.234700000000000,-0.950700000000000,-0.202900000000000;-0.150100000000000,-0.988600000000000,-0.0139000000000000;0.166200000000000,-0.833600000000000,-0.526700000000000;-0.0405000000000000,-0.997500000000000,-0.0578000000000000;-0.0508000000000000,-0.983400000000000,0.174000000000000;0.0519000000000000,-0.967900000000000,0.245900000000000;-0.155700000000000,-0.982600000000000,0.101700000000000;0.0371000000000000,-0.931700000000000,0.361300000000000;-0.0723000000000000,-0.912400000000000,0.402800000000000;0.0139000000000000,-0.880800000000000,0.473400000000000;-0.0967000000000000,-0.853100000000000,0.512700000000000;-0.0126000000000000,-0.815100000000000,0.579200000000000;-0.128900000000000,-0.783300000000000,0.608200000000000;-0.0434000000000000,-0.738900000000000,0.672400000000000;-0.0726000000000000,-0.652800000000000,0.754100000000000;0.0163000000000000,-0.591600000000000,0.806100000000000;-0.0223000000000000,-0.389000000000000,0.920900000000000;-0.0388000000000000,-0.278100000000000,0.959800000000000;-0.00180000000000000,-0.137500000000000,-0.990500000000000;-0.00770000000000000,-0.606900000000000,-0.794700000000000;0.00610000000000000,-0.689100000000000,-0.724600000000000;-0.0237000000000000,-0.762400000000000,-0.646600000000000;-0.0498000000000000,-0.828000000000000,-0.558600000000000;0.0725000000000000,-0.804100000000000,-0.590000000000000;0.0220000000000000,0.577200000000000,-0.816300000000000;-0.100200000000000,-0.199400000000000,-0.974800000000000;0.0457000000000000,-0.866700000000000,-0.496700000000000;0.139700000000000,-0.892500000000000,-0.428800000000000;0.230100000000000,-0.908000000000000,-0.350000000000000;0.0824000000000000,-0.972400000000000,-0.218400000000000;0.178400000000000,-0.973200000000000,-0.144900000000000;0.0652000000000000,-0.997800000000000,0.0141000000000000;-0.163500000000000,-0.930600000000000,0.327500000000000;0.169100000000000,-0.982300000000000,0.0811000000000000;0.0590000000000000,-0.989800000000000,0.130000000000000;0.160300000000000,-0.967100000000000,0.197600000000000;-0.860900000000000,-0.234100000000000,-0.451700000000000;0.146700000000000,-0.937700000000000,0.314900000000000;0.125800000000000,-0.894500000000000,0.429000000000000;-0.520100000000000,0.319000000000000,0.792300000000000;0.0987000000000000,-0.837800000000000,0.537000000000000;0.181300000000000,-0.784000000000000,0.593700000000000;0.0708000000000000,-0.765900000000000,0.639000000000000;0.153300000000000,-0.706000000000000,0.691400000000000;0.0418000000000000,-0.683200000000000,0.729000000000000;-0.00400000000000000,-0.493500000000000,0.869700000000000;0.110000000000000,-0.522600000000000,0.845500000000000;-0.0854000000000000,-0.0362000000000000,0.995700000000000;-0.957300000000000,-0.240400000000000,-0.160300000000000;0.0732000000000000,-0.451700000000000,-0.889200000000000;0.189400000000000,-0.485400000000000,-0.853500000000000;0.205700000000000,-0.582700000000000,-0.786200000000000;0.102000000000000,-0.731100000000000,-0.674600000000000;0.195000000000000,-0.763400000000000,-0.615800000000000;0.284800000000000,-0.787600000000000,-0.546400000000000;0.966700000000000,-0.220600000000000,0.130000000000000;0.255600000000000,-0.853700000000000,-0.453700000000000;0.306900000000000,-0.919600000000000,-0.245500000000000;-0.435600000000000,-0.406500000000000,0.803200000000000;-0.916500000000000,-0.162100000000000,-0.365800000000000;0.281100000000000,-0.953000000000000,-0.112800000000000;0.275800000000000,-0.961100000000000,0.0160000000000000;-0.924300000000000,-0.367100000000000,0.104700000000000;0.176200000000000,-0.983800000000000,-0.0338000000000000;0.267000000000000,-0.953600000000000,0.139200000000000;0.253400000000000,-0.931600000000000,0.260400000000000;0.357200000000000,-0.911300000000000,0.204900000000000;0.233600000000000,-0.205700000000000,-0.950300000000000;-0.0703000000000000,0.281800000000000,0.956900000000000;0.235600000000000,-0.894900000000000,0.379100000000000;0.320500000000000,-0.839000000000000,0.439700000000000;0.295000000000000,-0.783900000000000,0.546300000000000;0.609000000000000,0.315600000000000,0.727600000000000;0.261700000000000,-0.719700000000000,0.643100000000000;0.237300000000000,-0.636400000000000,0.734000000000000;0.333600000000000,-0.562500000000000,0.756500000000000;0.128500000000000,-0.617500000000000,0.776000000000000;0.0913000000000000,-0.421100000000000,0.902400000000000;-0.982300000000000,-0.165600000000000,0.0874000000000000;0.140900000000000,-0.275500000000000,-0.950900000000000;0.167400000000000,-0.382500000000000,-0.908700000000000;0.282500000000000,-0.417000000000000,-0.863900000000000;0.300200000000000,-0.517800000000000,-0.801100000000000;0.305300000000000,-0.615700000000000,-0.726400000000000;0.416000000000000,0.439300000000000,-0.796200000000000;0.397800000000000,-0.641000000000000,-0.656400000000000;0.483600000000000,-0.658100000000000,-0.577100000000000;0.335700000000000,-0.867300000000000,-0.367500000000000;0.448300000000000,-0.810800000000000,-0.376400000000000;0.376600000000000,-0.913100000000000,-0.156400000000000;0.523100000000000,-0.804900000000000,-0.280200000000000;0.471700000000000,-0.859900000000000,-0.195200000000000;0.470900000000000,-0.878500000000000,-0.0807000000000000;0.562600000000000,-0.826300000000000,-0.0268000000000000;0.468000000000000,-0.883100000000000,0.0342000000000000;-0.270100000000000,-0.0820000000000000,0.959300000000000;0.646300000000000,-0.758100000000000,-0.0868000000000000;0.459200000000000,-0.875500000000000,0.150500000000000;0.970500000000000,0.00710000000000000,0.240900000000000;0.442900000000000,-0.856000000000000,0.266600000000000;0.421800000000000,-0.822300000000000,0.382000000000000;0.683600000000000,-0.0874000000000000,-0.724600000000000;0.594300000000000,-0.713100000000000,0.371900000000000;0.415800000000000,0.678900000000000,0.605100000000000;0.472300000000000,-0.684900000000000,0.554800000000000;0.343300000000000,-0.645500000000000,0.682300000000000;0.440200000000000,-0.600000000000000,0.667900000000000;-0.464000000000000,-0.874700000000000,0.140400000000000;0.222500000000000,-0.545500000000000,0.808000000000000;0.184600000000000,-0.343100000000000,0.921000000000000;0.0725000000000000,-0.312600000000000,0.947100000000000;0.113400000000000,-0.162400000000000,-0.980200000000000;0.259900000000000,-0.312500000000000,-0.913700000000000;0.389300000000000,-0.443800000000000,-0.807200000000000;0.399500000000000,-0.546000000000000,-0.736400000000000;0.490700000000000,-0.567800000000000,-0.661000000000000;0.575000000000000,-0.581600000000000,-0.575400000000000;0.563300000000000,-0.665400000000000,-0.489800000000000;0.464900000000000,-0.740100000000000,-0.486000000000000;0.638100000000000,-0.660700000000000,-0.395400000000000;0.537900000000000,-0.742100000000000,-0.400100000000000;0.628400000000000,-0.750100000000000,-0.206000000000000;-0.000600000000000000,0.0683000000000000,-0.997700000000000;0.560300000000000,-0.815200000000000,-0.146800000000000;0.712900000000000,-0.683200000000000,-0.158100000000000;0.725000000000000,-0.687700000000000,-0.0371000000000000;0.556900000000000,-0.825600000000000,0.0907000000000000;0.646500000000000,-0.762300000000000,0.0301000000000000;-0.602500000000000,-0.687800000000000,0.404900000000000;0.637700000000000,-0.756400000000000,0.145600000000000;0.543700000000000,-0.813400000000000,0.206900000000000;0.522600000000000,-0.789600000000000,0.321700000000000;0.688300000000000,-0.656500000000000,0.308700000000000;0.496300000000000,-0.750800000000000,0.435800000000000;0.560500000000000,-0.672400000000000,0.483400000000000;0.617200000000000,-0.585500000000000,0.525600000000000;0.529900000000000,-0.599400000000000,0.599900000000000;0.426200000000000,-0.502600000000000,0.752100000000000;0.317100000000000,-0.471200000000000,0.823000000000000;0.296000000000000,-0.369900000000000,0.880600000000000;0.325400000000000,0.370600000000000,0.870000000000000;0.273400000000000,-0.261300000000000,0.925700000000000;0.0227000000000000,-0.245600000000000,-0.969100000000000;0.346600000000000,-0.229800000000000,-0.909400000000000;0.370700000000000,-0.338500000000000,-0.864800000000000;0.485200000000000,-0.467500000000000,-0.738900000000000;0.565600000000000,-0.381600000000000,-0.731000000000000;0.572200000000000,-0.485400000000000,-0.661100000000000;0.650700000000000,-0.496100000000000,-0.574800000000000;-0.646900000000000,-0.599700000000000,-0.471000000000000;0.653600000000000,-0.586100000000000,-0.478800000000000;0.722700000000000,-0.589700000000000,-0.360400000000000;0.692200000000000,-0.665700000000000,-0.278600000000000;0.553600000000000,0.756800000000000,-0.347500000000000;0.766800000000000,-0.600500000000000,-0.227000000000000;-0.337400000000000,-0.688700000000000,-0.641800000000000;0.787000000000000,-0.608100000000000,-0.104300000000000;0.793900000000000,-0.607800000000000,0.0170000000000000;0.852000000000000,-0.518200000000000,0.0741000000000000;-0.0560000000000000,-0.160400000000000,0.985500000000000;0.620300000000000,-0.740100000000000,0.259700000000000;-0.521000000000000,-0.445100000000000,0.728300000000000;-0.398600000000000,-0.801400000000000,0.445900000000000;-0.623300000000000,-0.774000000000000,-0.111800000000000;0.656900000000000,-0.627200000000000,0.418400000000000;0.616100000000000,-0.507900000000000,0.602000000000000;0.812400000000000,-0.00970000000000000,-0.583000000000000;0.899500000000000,-0.325900000000000,-0.291000000000000;0.589900000000000,-0.419400000000000,0.690000000000000;0.403300000000000,-0.397700000000000,0.824100000000000;0.382000000000000,-0.289100000000000,0.877800000000000;0.355900000000000,-0.177200000000000,0.917600000000000;0.0528000000000000,-0.196900000000000,0.979000000000000;0.318500000000000,-0.117400000000000,-0.940600000000000;0.452600000000000,-0.252800000000000,-0.855100000000000;0.473000000000000,-0.361600000000000,-0.803400000000000;0.725700000000000,-0.404000000000000,-0.557000000000000;0.550700000000000,-0.273200000000000,-0.788700000000000;0.649800000000000,-0.396200000000000,-0.648700000000000;-0.559700000000000,0.118500000000000,-0.820200000000000;0.851300000000000,-0.219800000000000,-0.476500000000000;0.520800000000000,-0.512900000000000,0.682400000000000;0.792400000000000,-0.404800000000000,-0.456300000000000;0.0445000000000000,0.669600000000000,-0.741400000000000;0.775700000000000,-0.499200000000000,-0.386100000000000;0.875500000000000,-0.426600000000000,-0.226800000000000;-0.160000000000000,-0.703100000000000,0.692900000000000;0.896200000000000,-0.430500000000000,-0.107300000000000;0.837900000000000,-0.520600000000000,-0.163900000000000;0.903300000000000,-0.428800000000000,0.0128000000000000;0.376000000000000,-0.708700000000000,0.596900000000000;0.897900000000000,-0.419900000000000,0.131900000000000;0.850300000000000,-0.382900000000000,0.361000000000000;0.817800000000000,-0.488300000000000,0.304600000000000;0.599800000000000,0.00420000000000000,0.800100000000000;0.782600000000000,-0.464000000000000,0.415100000000000;0.731400000000000,-0.439300000000000,0.521700000000000;0.747900000000000,-0.331000000000000,0.575300000000000;0.673400000000000,-0.415900000000000,0.611200000000000;0.668000000000000,-0.318000000000000,0.672800000000000;0.579700000000000,-0.317800000000000,0.750300000000000;0.499800000000000,-0.413200000000000,0.761200000000000;-0.528800000000000,0.572600000000000,0.626500000000000;0.433800000000000,-0.0891000000000000,0.896600000000000;0.245800000000000,-0.146500000000000,0.958200000000000;0.0798000000000000,-0.0428000000000000,-0.995900000000000;0.425600000000000,-0.140700000000000,-0.893900000000000;0.989400000000000,-0.135600000000000,-0.0516000000000000;0.374300000000000,0.927100000000000,0.0177000000000000;0.621300000000000,-0.181600000000000,-0.762200000000000;0.707100000000000,-0.197500000000000,-0.679000000000000;0.783900000000000,-0.209400000000000,-0.584500000000000;0.793500000000000,-0.309700000000000,-0.523900000000000;0.897400000000000,-0.129200000000000,-0.422000000000000;0.905400000000000,-0.228000000000000,-0.358100000000000;0.854800000000000,-0.317100000000000,-0.410800000000000;0.943300000000000,-0.234100000000000,-0.235200000000000;0.926900000000000,-0.334100000000000,-0.171100000000000;0.964900000000000,-0.237400000000000,-0.112200000000000;0.880500000000000,-0.404100000000000,0.247900000000000;0.972500000000000,-0.232800000000000,0.0104000000000000;0.941100000000000,-0.334500000000000,-0.0494000000000000;0.989900000000000,-0.124100000000000,0.0687000000000000;0.941900000000000,-0.328100000000000,0.0716000000000000;0.443900000000000,0.0755000000000000,-0.892900000000000;0.930200000000000,-0.314300000000000,0.189800000000000;-0.258800000000000,-0.965400000000000,0.0323000000000000;0.905300000000000,-0.295600000000000,0.305100000000000;0.805700000000000,-0.359300000000000,0.471000000000000;0.813200000000000,-0.250900000000000,0.525100000000000;0.739600000000000,-0.230500000000000,0.632400000000000;0.721300000000000,-0.127500000000000,0.680700000000000;0.654200000000000,-0.215900000000000,0.724900000000000;-0.761700000000000,0.0246000000000000,0.647500000000000;0.508100000000000,0.00160000000000000,0.861300000000000;0.900500000000000,0.392100000000000,-0.188100000000000;0.289400000000000,-0.000600000000000000,-0.957200000000000;0.393500000000000,-0.0238000000000000,-0.919000000000000;0.494000000000000,-0.0464000000000000,-0.868200000000000;0.592900000000000,-0.0697000000000000,-0.802300000000000;0.736300000000000,0.00760000000000000,-0.676600000000000;0.764900000000000,-0.103000000000000,-0.635800000000000;0.836600000000000,-0.118000000000000,-0.534900000000000;0.771300000000000,0.404200000000000,-0.491600000000000;0.804300000000000,0.355800000000000,0.476000000000000;-0.124000000000000,-0.960900000000000,-0.247700000000000;0.944000000000000,-0.135900000000000,-0.300700000000000;0.970100000000000,-0.0408000000000000,-0.239300000000000;0.974700000000000,-0.138500000000000,-0.175600000000000;0.992800000000000,-0.0379000000000000,-0.114000000000000;0.999600000000000,-0.0261000000000000,0.00610000000000000;0.995700000000000,0.0727000000000000,-0.0575000000000000;-0.160100000000000,-0.963300000000000,0.215400000000000;0.991900000000000,-0.0126000000000000,0.126100000000000;0.976200000000000,-0.109100000000000,0.187400000000000;0.947300000000000,-0.203800000000000,0.247200000000000;0.914400000000000,-0.183700000000000,0.360700000000000;0.949100000000000,-0.0894000000000000,0.301900000000000;0.866500000000000,-0.274200000000000,0.417100000000000;0.867000000000000,-0.163700000000000,0.470700000000000;0.802000000000000,-0.147900000000000,0.578700000000000;0.887700000000000,0.355000000000000,-0.293100000000000;0.693300000000000,-0.0221000000000000,0.720300000000000;0.631300000000000,-0.109200000000000,0.767800000000000;-0.0455000000000000,-0.997300000000000,0.0585000000000000;0.325000000000000,-0.0616000000000000,0.943700000000000;0.135500000000000,-0.111400000000000,0.984500000000000];
	end
    
    properties (SetAccess = private)
        % Defaults from paper except for N and K
        
        %% Atmospheric light estimation parameters
        thres       = 0.02;             % Threshold for accepting an atmospheric light colour
        spacing     = 0.02;             % Spacing of atmospheric light colours to check
        N           = 1000;             % Number of colour clusters
        K           = 40;               % Number of colour directions to check
        Amin        = [0,0.05,0.1];     % Lower bound for the atmospheric light
        Amax        = [1,1,1];          % Upper bound for the atmospheric light
        %% Dehazing parameters
        gamma       = 1;                % Image gamma correction factor.
        lambda      = 0.1;              % Degree of transmission map smoothing
        omega       = 1.06;             % Proportion of haze to leave. Functions differently from other omega parameters. Values larger than 1 retain more haze
        t0          = 0.1;              % Lower bound for transmission map
    end
    
    methods
        function self = BermanDehazer(gamma, lambda, omega, t0, Amin, Amax, N, spacing, K, thres)
            self = self@BaseDehazer;
            
            if nargin>0 && ~isempty(gamma), self.gamma = gamma; end
            if nargin>1 && ~isempty(lambda), self.lambda = lambda; end
            if nargin>2 && ~isempty(omega), self.omega = omega; end
            if nargin>3 && ~isempty(t0), self.t0 = t0; end
            if nargin>4 && ~isempty(Amin), self.Amin = Amin; end
            if nargin>5 && ~isempty(Amax), self.Amax = Amax; end
            if nargin>6 && ~isempty(N), self.N = N; end
            if nargin>7 && ~isempty(spacing), self.spacing = spacing; end
            if nargin>8 && ~isempty(K), self.K = K; end
            if nargin>9 && ~isempty(thres), self.thres = thres; end
            
        end
        
        
        function [predImage, predT, predA, timeImage, timeA] = dehazeFrame(self, img, ~)
            Atic = tic;
            predA = self.estimateA(img);
            predA = reshape(predA, 1,1,3);
            timeA = toc(Atic);
            predTic = tic;
            [predImage, predT] = self.nonLocalDehazing(img, predA);
            predImage = BaseDehazer.clip(predImage);
            predT = BaseDehazer.clip(predT);
            timeImage = toc(predTic);
        end
    end
       
    methods (Access = protected)
        function [ Aout ] = estimateA(self, img)
            %% Convert input image to an indexed image
            [img_ind, points] = rgb2ind(img, self.N);
            [m,n,~] = size(img);
            % Remove empty clusters
            idxToUse = unique(img_ind(:));
            idxToRemove = setdiff(0:(size(points,1)-1),idxToUse);
            points(idxToRemove+1,:) = [];
			imgSeq = changem(img_ind,1:length(idxToUse),idxToUse);
            % img_ind_sequential = zeros(h,w);
            % for kk = 1:length(idx_in_use)
                % img_ind_sequential(img_ind==idx_in_use(kk)) = kk;
            % end
            % Now the min value of img_ind_sequential is 1 rather then 0, and the indices
            % correspond to points

            % Count the occurences if each index - this is the clusters' weight
            [weights,~] = histcounts(imgSeq(:),size(points,1));
            weights = weights./(m*n);
            if ~ismatrix(points), points = reshape(points,[],3); end % verify dim

            %% Define arrays of candidate air-light values and angles
            angleList = reshape(linspace(0, pi, self.K),[],1);
            % Use angle_list(1:end-1) since angle_list(end)==pi, which is the same line
            % in 2D as since angle_list(1)==0
            allDirections = [sin(angleList(1:end-1)) , cos(angleList(1:end-1)) ];

            % Air-light candidates in each color channel
            ArangeR = self.Amin(1):self.spacing:self.Amax(1);
            ArangeG = self.Amin(2):self.spacing:self.Amax(2);
            ArangeB = self.Amin(3):self.spacing:self.Amax(3);

            %% Estimate air-light in each pair of color channels
            % Estimate RG
            Aall = self.generateAValues(ArangeR, ArangeG);
            [~, AvoteRG] = self.vote2D(points(:,1:2), weights, allDirections, Aall);
            % Estimate GB
            Aall = self.generateAValues(ArangeG, ArangeB);
            [~, AvoteGB] = self.vote2D(points(:,2:3), weights, allDirections, Aall);
            % Estimate RB
            Aall = self.generateAValues(ArangeR, ArangeB);
            [~, AvoteRB] = self.vote2D(points(:,[1,3]), weights, allDirections, Aall);

            %% Find most probable airlight from marginal probabilities (2D arrays)
            % Normalize (otherwise the numbers are quite large)
            maxVal = max( [max(AvoteRB(:)) , max(AvoteRG(:)) , max(AvoteGB(:)) ]);
            AvoteRG2 = AvoteRG./maxVal;
            AvoteGB2 = AvoteGB./maxVal;
            AvoteRB2 = AvoteRB./maxVal;
            % Generate 3D volumes from 3 different 2D arrays
            A11 = repmat( reshape(AvoteRG2, length(ArangeG),length(ArangeR))', 1,1,length(ArangeB));
            tmp = reshape(AvoteRB2, length(ArangeB),length(ArangeR))';
            A22 = repmat(reshape(tmp, length(ArangeR),1,length(ArangeB)) , 1,length(ArangeG),1);
            tmp2 = reshape(AvoteGB2, length(ArangeB),length(ArangeG))';
            A33 = repmat(reshape(tmp2, 1, length(ArangeG),length(ArangeB)) , length(ArangeR),1,1);
            AvoteAll = A11.*A22.*A33;
            [~, idx] = max(AvoteAll(:));
            [idx_r,idx_g,idx_b] = ind2sub([length(ArangeR),length(ArangeG),length(ArangeB)],idx);
            Aout = [ArangeR(idx_r), ArangeG(idx_g), ArangeB(idx_b)];
        end
        
        function Aall = generateAValues(~, Avals1, Avals2)
            %Generate a list of air-light candidates of 2-channels, using two lists of
            %values in a single channel each
            %Aall's length is length(Avals1)*length(Avals2)
            Avals1 = reshape(Avals1,[],1);
            Avals2 = reshape(Avals2,[],1);
            A1 = kron(Avals1, ones(length(Avals2),1));
            A2 = kron(ones(length(Avals1),1), Avals2);
            Aall = [A1, A2];
        end
        

		function [Aout, Avote2] = vote2D(self, points, pointWeight, allDirections, Aall)
			
			check = bsxfun(@and,Aall(:,1)>points(:,1)',Aall(:,2)>points(:,2)');
			
			dist = pdist2(Aall,points);
			comp = dist./sqrt(2) + 1;
			
			p1 = -points(:,1) * allDirections(:,2)' + points(:,2) * allDirections(:,1)';
			p1 = reshape(p1,[1 size(p1)]);
			
			p2 = Aall(:, 1)*allDirections(:,2)' - Aall(:, 2)*allDirections(:,1)';
			p2 = reshape(p2, [size(p2,1) 1 size(p2,2)]);
			
			val = abs(p1+p2); %bsxfun(@plus,p1,p2);
			
			accVotes = bsxfun(@and, check, val<2*self.thres.*comp);

			accVotes2 = (sum(uint8(accVotes),2))>=2; 
			accVotes = bsxfun(@and, accVotes ,accVotes2);
			
			pointWeightDist = (5.*exp(-dist)+1).*pointWeight; 
			indx = bsxfun(@and,any(accVotes,3),check);
			accumulator_unique = sum(pointWeightDist.*indx,2);

			[~, Aestimate_idx] = max(accumulator_unique);
			Aout = Aall(Aestimate_idx,:);
			Avote2 = accumulator_unique; 
		end
        
        function [predImage, predT] = nonLocalDehazing(self, hazyImage, A)
            [m,n,n_colors] = size(hazyImage);
            hazyImage = hazyImage.^self.gamma;
            %% Find Haze-lines
            % Translate the coordinate system to be air_light-centric (Eq. (3))
			
			ADist = hazyImage - A;

            % Calculate radius (Eq. (5))
            radius = sqrt( ADist(:,:,1).^2 + ADist(:,:,2).^2 +ADist(:,:,3).^2 );

            % Cluster the pixels to haze-lines
            % Use a KD-tree impementation for fast clustering according to their angles
            distRadius = reshape(ADist,[m*n,n_colors]);
            distNorm = sqrt(sum(distRadius.^2,2));
            distRadius = bsxfun(@rdivide, distRadius, distNorm);
            
            mdl = KDTreeSearcher(self.KD_points);
            ind = knnsearch(mdl, distRadius);


            %% Estimating Initial Transmission

            % Estimate radius as the maximal radius in each haze-line (Eq. (11))
            k = accumarray(ind,radius(:),[self.KD_n,1],@max);
            newRadius = reshape( k(ind), m, n);

            % Estimate transmission as radii ratio (Eq. (12))
            transEst = radius./newRadius;

            % Limit the transmission to the range [t0, 1] for numerical stability
            self.t0 = 0.1;
            transEst = min(max(transEst, self.t0),1);


            %% Regularization

            % Apply lower bound from the image (Eqs. (13-14))
            lowerBound = 1 - min(bsxfun(@rdivide,hazyImage,reshape(A,1,1,3)) ,[],3);
            transEst = max(transEst, lowerBound);

            % Solve optimization problem (Eq. (15))
            % find bin counts for reliability - small bins (#pixels<50) do not comply with 
            % the model assumptions and should be disregarded
            bin_count       = accumarray(ind,1,[self.KD_n,1]);
            bin_count_map   = reshape(bin_count(ind),m,n);
            bin_eval_fun    = @(x) min(1, x/50);

            % Calculate std - this is the data-term weight of Eq. (15)
            K_std = accumarray(ind,radius(:),[self.KD_n,1],@std);
            radiusStd = reshape( K_std(ind), m, n);
            radiusEval = @(r) min(1, 3*max(0.001, r-0.1));
            radiusReliability = radiusEval(radiusStd./max(radiusStd(:)));
            dataWeight   = bin_eval_fun(bin_count_map).*radiusReliability;
            predT = self.wlsOptimsation(transEst, dataWeight, hazyImage);


            %% Dehazing
            % (Eq. (16))
             % leave a bit of haze for a natural look (set to 1 to reduce all haze)
			predImage = (hazyImage - (1-self.omega.*predT).*A)./ max(predT,self.t0);
            
            % Limit each pixel value to the range [0, 1] (avoid numerical problems)
            predImage = BaseDehazer.clip(predImage);
            predImage = predImage.^(1/self.gamma); % radiometric correction

            % For display, we perform a global linear contrast stretch on the output, 
            % clipping 0.5% of the pixel values both in the shadows and in the highlights 
            percent = [0.005, 0.995];
            minn=min(predImage(:));
            predImage=predImage-minn;
            predImage=predImage./max(predImage(:));

            % limit the change magnitude so the WB would not be drastically changed
            contrastLimit = stretchlim(predImage,percent);
            val = 0.2;
            contrastLimit(2,:) = max(contrastLimit(2,:), 0.2);
            contrastLimit(2,:) = val*contrastLimit(2,:) + (1-val)*max(contrastLimit(2,:), mean(contrastLimit(2,:)));
            contrastLimit(1,:) = val*contrastLimit(1,:) + (1-val)*min(contrastLimit(1,:), mean(contrastLimit(1,:)));
            predImage=imadjust(predImage,contrastLimit,[],1);

        end
        
        function out = wlsOptimsation(self, in, weights, guide)
            eps = 0.00001;

            [m,n,~] = size(guide);
            k = m*n;
            guide = rgb2gray(guide);

            % Compute affinities between adjacent pixels based on gradients of guidance
            dy = diff(guide, 1, 1);
            dy = -self.lambda./(sum(abs(dy).^2,3) + eps);
            dy = padarray(dy, [1 0], 'post');
            dy = dy(:);

            dx = diff(guide, 1, 2); 
            dx = -self.lambda./(sum(abs(dx).^2,3) + eps);
            dx = padarray(dx, [0 1], 'post');
            dx = dx(:);


            % Construct a five-point spatially inhomogeneous Laplacian matrix
            B = [dx, dy];
            d = [-m,-1];
            tmp = spdiags(B,d,k,k);

            ea = dx;
            we = padarray(dx, m, 'pre'); we = we(1:end-m);
            so = dy;
            no = padarray(dy, 1, 'pre'); no = no(1:end-1);

            D = -(ea+we+so+no);
            Asmoothness = tmp + tmp' + spdiags(D, 0, k, k);

            % Normalize data weight
            weights = weights - min(weights(:)) ;
            weights = 1.*weights./(max(weights(:))+eps);

            % Make sure we have a boundary condition for the top line:
            % It will be the minimum of the transmission in each column
            % With reliability 0.8
            mask = weights(1,:) < 0.6; % find missing boundary condition
            in_row1 = min( in,[], 1);
            weights(1,mask) = 0.8;
            in(1,mask) = in_row1(mask);

            Adata = spdiags(weights(:), 0, k, k);

            A = Adata + Asmoothness;
            b = Adata*in(:);

            % Solve
%             out = lsqnonneg(A,b);
            out = A\b;
            out = reshape(out, m, n);
        end
    end
	
end

